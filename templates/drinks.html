<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíß Drinks & Hydration Calculator</title>
    <meta name="description" content="Calculate your caffeine intake and net hydration effect from different beverages. Track coffee, tea, soda, energy drinks and more.">
    <meta name="keywords" content="caffeine intake calculator, coffee hydration effects, tea water content, soda hydration impact, energy drink analysis, beverage caffeine tracker, drinks water calculator, net hydration calculator, coffee dehydration myth, liquid intake tracker, beverage hydration guide, caffeine consumption monitor">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíß</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #334155;
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            min-height: 100vh;
            margin: 0;
            transition: margin-left 0.3s ease;
        }

        /* Desktop: Apply side navigation margin */
        @media (min-width: 769px) {
            body {
                margin-left: 250px;
            }

            body.nav-closed {
                margin-left: 0;
            }
        }

        /* Toggle Button - Mobile First */
        .nav-toggle {
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: #0ea5e9;
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem;
            min-height: 40px;
            min-width: 40px;
            contain: layout style;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            transform: translateZ(0);
            cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        /* Hide navigation toggle on desktop */
        @media (min-width: 769px) {
            .nav-toggle {
                display: none;
            }
        }

        .nav-toggle:hover {
            background: #0284c7;
            transform: scale(1.05);
        }

        .hamburger {
            width: 20px;
            height: 2px;
            background: white;
            transition: all 0.2s ease;
        }

        .nav-toggle.active .hamburger:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .nav-toggle.active .hamburger:nth-child(2) {
            opacity: 0;
        }

        .nav-toggle.active .hamburger:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        /* Side Navigation */
        .side-nav {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .side-nav.closed {
            transform: translateX(-100%);
        }

        .nav-header {
            padding: 2rem 1.5rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0.25rem;
            border-radius: 0.25rem;
        }

        .nav-close:hover {
            background: #f8fafc;
            color: #1e293b;
        }

        .nav-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .nav-menu {
            list-style: none;
            padding: 1rem 0;
            margin: 0;
        }

        .nav-menu li {
            margin: 0;
        }

        .nav-link {
            display: block;
            padding: 1rem 1.5rem;
            color: #64748b;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background: #f8fafc;
            color: #0ea5e9;
        }

        .nav-link.active {
            background: rgba(14, 165, 233, 0.1);
            color: #0ea5e9;
            border-left-color: #0ea5e9;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            text-align: center;
            margin: 2rem 0 3rem;
            padding: 2rem 1rem;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0ea5e9;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            color: #64748b;
        }

        .drinks-calculator {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .calculator-header {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .calculator-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .calculator-header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .drink-entry-section {
            padding: 2rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .form-row {
            display: grid;
            gap: 0.75rem;
            grid-template-columns: 1.8fr 1.2fr 0.8fr 0.8fr 0.8fr 0.8fr auto;
            align-items: end;
        }

        .form-field {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-field label {
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .drink-select,
        .form-field input {
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .drink-select:focus,
        .form-field input:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }

        .add-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .add-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .add-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .drinks-list {
            padding: 2rem;
        }

        .drinks-list h4 {
            color: #1f2937;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .no-drinks {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 2rem;
            background: #f9fafb;
            border-radius: 0.75rem;
            border: 2px dashed #d1d5db;
        }

        .drink-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .drink-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .drink-emoji {
            font-size: 1.5rem;
        }

        .drink-details {
            display: flex;
            flex-direction: column;
        }

        .drink-name {
            font-weight: 600;
            color: #1f2937;
        }

        .drink-stats {
            font-size: 0.85rem;
            color: #6b7280;
        }

        .drink-actions {
            display: flex;
            gap: 0.5rem;
        }

        .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: #dc2626;
        }

        .settings-section {
            background: #fef7f0;
            border: 2px solid #fed7aa;
            padding: 1.5rem;
            border-radius: 1rem;
            margin-bottom: 1.5rem;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 1.2rem;
            height: 1.2rem;
            accent-color: #0ea5e9;
        }

        .checkbox-group label {
            font-weight: 500;
            color: #92400e;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #0ea5e9;
            color: white;
            box-shadow: 0 4px 14px rgba(14, 165, 233, 0.3);
        }

        .btn-primary:hover {
            background: #0284c7;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
        }

        .btn-secondary {
            background: #64748b;
            color: white;
            box-shadow: 0 4px 14px rgba(100, 116, 139, 0.3);
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        .results-section {
            background: white;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin: 2rem 0;
            border-left: 4px solid #0ea5e9;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .results-section.show {
            opacity: 1;
            transform: translateY(0);
        }

        .results-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .results-grid {
            display: grid;
            gap: 1rem;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            margin-bottom: 1.5rem;
        }

        .result-card {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .result-label {
            color: #64748b;
            font-size: 0.9rem;
        }

        .status-safe { color: #059669; }
        .status-warning { color: #d97706; }
        .status-danger { color: #dc2626; }

        .status-message {
            padding: 1rem;
            border-radius: 0.75rem;
            margin: 1rem 0;
            font-weight: 500;
            text-align: center;
        }

        .status-message.safe {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .status-message.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fed7aa;
        }

        .status-message.danger {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .hydration-tip {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            padding: 1.5rem;
            border-radius: 1rem;
            margin-top: 2rem;
            text-align: center;
        }

        .hydration-tip h4 {
            color: #0369a1;
            margin-bottom: 0.5rem;
        }

        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid #fecaca;
            text-align: center;
            margin: 1rem 0;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            body {
                margin-left: 0;
            }
            
            .side-nav {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            
            .nav-menu {
                display: flex;
                overflow-x: auto;
                padding: 0.5rem;
            }
            
            .nav-menu li {
                flex-shrink: 0;
            }
            
            .nav-link {
                padding: 0.75rem 1rem;
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .nav-link.active {
                border-left: none;
                border-bottom-color: #0ea5e9;
            }

            .container {
                padding: 0.5rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-row {
                grid-template-columns: 1fr !important;
                gap: 1rem;
            }

            .drink-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .drink-actions {
                align-self: stretch;
                justify-content: center;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                padding: 0.75rem 1.5rem;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Toggle Button -->
        <button class="nav-toggle" id="navToggle" onclick="toggleNavigation()">
            <span class="hamburger"></span>
            <span class="hamburger"></span>
            <span class="hamburger"></span>
        </button>

        <!-- Side Navigation -->
        <nav class="side-nav" id="sideNav">
            <div class="nav-header">
                <h3>üíß Calculators</h3>
                <button class="nav-close" onclick="closeNavigation()">‚úï</button>
            </div>
            <ul class="nav-menu">
                <li><a href="/" class="nav-link">üíß Water Calculator</a></li>
                <li><a href="/drinks" class="nav-link active">‚òï Drinks Calculator</a></li>
                <li><a href="/sugar" class="nav-link">üç¨ Sweet Calculator</a></li>
            </ul>
        </nav>

        <!-- Header -->
        <div class="header">
            <h1>üíß Drinks Calculator</h1>
            <p>Track caffeine intake and hydration effect of your drinks</p>
        </div>

        <!-- User Settings -->
        <div class="settings-section">
            <div class="checkbox-group">
                <input type="checkbox" id="pregnantNursing" name="pregnantNursing">
                <label for="pregnantNursing">Pregnant / Nursing?</label>
                <span class="tooltip" data-tooltip="Reduces safe caffeine limit to 200mg per day"></span>
            </div>
        </div>

        <!-- Unified Drinks Calculator -->
        <div class="drinks-calculator">
            <div class="calculator-header">
                <h3>üçπ Add Your Drinks</h3>
                <p>Select drinks and enter quantities to calculate total caffeine and hydration</p>
            </div>

            <!-- Drink Entry Form -->
            <div class="drink-entry-section">
                <div class="add-drink-form">
                    <div class="form-row">
                        <div class="form-field">
                            <label for="drinkType">Drink Type</label>
                            <select id="drinkType" class="drink-select" onchange="updateDrinkInfo()">
                                <option value="">Select a drink</option>
                                <option value="coffee" data-emoji="‚òï" data-caffeine="95" data-size="8">Coffee (8 oz cup)</option>
                                <option value="tea" data-emoji="üçµ" data-caffeine="47" data-size="8">Tea (8 oz cup)</option>
                                <option value="soda" data-emoji="ü•§" data-caffeine="40" data-size="12">Soda (12 oz can)</option>
                                <option value="energy" data-emoji="‚ö°" data-caffeine="80" data-size="8">Energy Drink (8 oz)</option>
                                <option value="custom" data-emoji="‚ûï" data-caffeine="0" data-size="8">Custom Drink</option>
                            </select>
                        </div>
                        
                        <div class="form-field" id="customNameField" style="display: none;">
                            <label for="drinkName">Drink Name</label>
                            <input type="text" id="drinkName" placeholder="e.g., Green Tea Latte">
                        </div>
                        
                        <div class="form-field" id="customCaffeineField" style="display: none;">
                            <label for="caffeineAmount">Caffeine (mg)</label>
                            <input type="number" id="caffeineAmount" min="0" placeholder="0">
                        </div>
                        
                        <div class="form-field" id="customSizeField" style="display: none;">
                            <label for="servingSize">Size (oz)</label>
                            <input type="number" id="servingSize" min="0" step="0.5" placeholder="8" value="8">
                        </div>
                        
                        <div class="form-field">
                            <label for="quantity">Quantity</label>
                            <input type="number" id="quantity" min="0" step="0.5" placeholder="1" value="1">
                        </div>
                        
                        <div class="form-field">
                            <label for="age">Age</label>
                            <input type="number" id="age" min="1" max="120" placeholder="25" value="25">
                        </div>
                        
                        <div class="form-field">
                            <button type="button" class="add-btn" onclick="addDrink()">+ Add</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Drinks List -->
            <div class="drinks-list" id="drinksList">
                <h4>Your Drinks</h4>
                <div id="drinksContainer">
                    <p class="no-drinks">No drinks added yet. Add your first drink above!</p>
                </div>
            </div>
        </div>

        <!-- Buttons -->
        <div class="button-group">
            <button class="btn btn-primary" onclick="calculateResults(); loadAd();">üíß Calculate</button>
            <button class="btn btn-secondary" onclick="resetForm()">üîÑ Reset</button>
        </div>

        
        <!-- Results Section -->
        <div id="resultsSection" class="results-section hidden">
            <div class="results-header">
                <h3 class="results-title">Your Caffeine & Hydration Results</h3>
            </div>
            
            <div class="results-grid">
                <div class="result-card">
                    <div id="caffeineValue" class="result-value">0 mg</div>
                    <div class="result-label">Total Caffeine</div>
                </div>
                <div class="result-card">
                    <div id="percentageValue" class="result-value">0%</div>
                    <div class="result-label">% of Safe Daily Limit</div>
                </div>
                <div class="result-card">
                    <div id="hydrationValue" class="result-value">0 ml</div>
                    <div class="result-label">Net Hydration</div>
                </div>
                <div class="result-card">
                    <div id="safetyValue" class="result-value">‚úÖ Safe</div>
                    <div class="result-label">Is it Safe for Me?</div>
                </div>
            </div>

            <div id="statusMessage" class="status-message"></div>
            <div id="hydrationMessage"></div>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message hidden">
            You haven't logged any drinks yet.
        </div>

        <!-- Personalized Smart Drinking Tips -->
        <div class="hydration-tip" id="personalizedTips">
            <h4>üí° Personalized Tips for You</h4>
            <div id="personalizedTipsContent" style="display: grid; gap: 0.75rem; margin-top: 1rem;">
                <p><strong>üíß Hydrate Extra:</strong> Drink 250ml extra water for every 100mg caffeine consumed.</p>
                <p><strong>‚è∞ Morning Rule:</strong> Have your strongest caffeinated drinks before noon to avoid sleep issues.</p>
                <p><strong>ü•õ Milk Magic:</strong> Add milk to coffee/tea - the protein slows caffeine absorption.</p>
                <p><strong>üçΩÔ∏è Food First:</strong> Never drink caffeine on an empty stomach to avoid jitters.</p>
                <p><strong>üîÑ Cycle Smart:</strong> Take 2-3 caffeine-free days per week to prevent tolerance buildup.</p>
            </div>
        </div>
    </div>

    <script>
        // Array to store all added drinks
        let addedDrinks = [];
        let drinkIdCounter = 0;
        
        function loadAd() {
            // Ad script is already loaded above
        }

        function triggerPopunderAd() {
            // Trigger the popunder ad script
            try {
                // The popunder script is already loaded, this will trigger it
                if (window.document) {
                    // Ads removed
                }
            } catch (error) {
                console.log('Ad trigger error:', error);
            }
        }

        // Predefined drink data
        const drinkPresets = {
            coffee: { emoji: '‚òï', name: 'Coffee', caffeine: 95, size: 8 },
            tea: { emoji: 'üçµ', name: 'Tea', caffeine: 47, size: 8 },
            soda: { emoji: 'ü•§', name: 'Soda', caffeine: 40, size: 12 },
            energy: { emoji: '‚ö°', name: 'Energy Drink', caffeine: 80, size: 8 }
        };

        function updateDrinkInfo() {
            const drinkType = document.getElementById('drinkType').value;
            const customFields = ['customNameField', 'customCaffeineField', 'customSizeField'];
            
            // Hide all custom fields first
            customFields.forEach(fieldId => {
                document.getElementById(fieldId).style.display = 'none';
            });

            // Show custom fields only if custom drink is selected
            if (drinkType === 'custom') {
                customFields.forEach(fieldId => {
                    document.getElementById(fieldId).style.display = 'block';
                });
                // Set default values for custom drink
                document.getElementById('servingSize').value = '8';
            }

            // Update form row layout for mobile
            updateFormLayout();
        }

        function updateFormLayout() {
            const formRow = document.querySelector('.form-row');
            const drinkType = document.getElementById('drinkType').value;
            
            if (window.innerWidth <= 768) {
                formRow.style.gridTemplateColumns = '1fr';
            } else {
                if (drinkType === 'custom') {
                    formRow.style.gridTemplateColumns = '1.8fr 1.2fr 0.8fr 0.8fr 0.8fr 0.8fr auto';
                } else {
                    formRow.style.gridTemplateColumns = '1.8fr 0.8fr 0.8fr auto';
                }
            }
        }

        function addDrink() {
            const drinkType = document.getElementById('drinkType').value;
            const quantity = parseFloat(document.getElementById('quantity').value) || 0;

            if (!drinkType || quantity <= 0) {
                alert('Please select a drink type and enter a valid quantity.');
                return;
            }

            let drink = {};

            if (drinkType === 'custom') {
                const name = document.getElementById('drinkName').value.trim();
                const caffeine = parseFloat(document.getElementById('caffeineAmount').value) || 0;
                const size = parseFloat(document.getElementById('servingSize').value) || 8;

                if (!name) {
                    alert('Please enter a name for your custom drink.');
                    return;
                }

                drink = {
                    id: drinkIdCounter++,
                    type: 'custom',
                    emoji: '‚ûï',
                    name: name,
                    caffeine: caffeine,
                    size: size,
                    quantity: quantity
                };
            } else {
                const preset = drinkPresets[drinkType];
                drink = {
                    id: drinkIdCounter++,
                    type: drinkType,
                    emoji: preset.emoji,
                    name: preset.name,
                    caffeine: preset.caffeine,
                    size: preset.size,
                    quantity: quantity
                };
            }

            addedDrinks.push(drink);
            updateDrinksList();
            clearForm();
        }

        function removeDrink(drinkId) {
            addedDrinks = addedDrinks.filter(drink => drink.id !== drinkId);
            updateDrinksList();
        }

        function updateDrinksList() {
            const container = document.getElementById('drinksContainer');
            
            if (addedDrinks.length === 0) {
                container.innerHTML = '<p class="no-drinks">No drinks added yet. Add your first drink above!</p>';
                return;
            }

            let html = '';
            addedDrinks.forEach(drink => {
                const totalCaffeine = drink.caffeine * drink.quantity;
                const totalFluid = drink.size * drink.quantity;
                
                html += `
                    <div class="drink-item">
                        <div class="drink-info">
                            <span class="drink-emoji">${drink.emoji}</span>
                            <div class="drink-details">
                                <span class="drink-name">${drink.name}</span>
                                <span class="drink-stats">${drink.quantity} √ó ${drink.size}oz = ${totalCaffeine}mg caffeine, ${totalFluid}oz fluid</span>
                            </div>
                        </div>
                        <div class="drink-actions">
                            <button class="remove-btn" onclick="removeDrink(${drink.id})">Remove</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function clearForm() {
            document.getElementById('drinkType').value = '';
            document.getElementById('quantity').value = '1';
            document.getElementById('drinkName').value = '';
            document.getElementById('caffeineAmount').value = '';
            document.getElementById('servingSize').value = '8';
            updateDrinkInfo();
        }

        function calculateResults() {
            if (addedDrinks.length === 0) {
                document.getElementById('errorMessage').classList.remove('hidden');
                document.getElementById('resultsSection').classList.add('hidden');
                return;
            }

            // Trigger popunder ad first
            triggerPopunderAd();

            // Hide error message
            document.getElementById('errorMessage').classList.add('hidden');

            let totalCaffeine = 0;
            let totalFluidMl = 0;

            // Calculate totals from added drinks
            addedDrinks.forEach(drink => {
                totalCaffeine += drink.caffeine * drink.quantity;
                totalFluidMl += drink.size * drink.quantity * 29.57; // Convert oz to ml
            });

            // Get user age for more accurate calculations
            const age = parseInt(document.getElementById('age').value) || 25;
            const isPregnantNursing = document.getElementById('pregnantNursing').checked;
            
            // Determine safe limit based on age and conditions
            let safeLimit;
            if (isPregnantNursing) {
                safeLimit = 200;
            } else if (age < 18) {
                safeLimit = 100; // Teens should have lower limits
            } else if (age > 65) {
                safeLimit = 300; // Seniors should be more cautious
            } else {
                safeLimit = 400; // Adults 18-65
            }

            // Calculate hydration adjustment
            let adjustedHydration = totalFluidMl;
            let hydrationStatus = "Hydration positive";
            
            if (totalCaffeine >= 500) {
                adjustedHydration *= 0.85; // Subtract 15%
                hydrationStatus = "Hydration negative risk";
            } else if (totalCaffeine >= 300) {
                adjustedHydration *= 0.90; // Subtract 10%
                hydrationStatus = "Slight hydration reduction";
            }

            // Calculate additional water needed to offset caffeine
            let additionalWaterNeeded = 0;
            if (totalCaffeine > 100) {
                // For every 100mg of caffeine, drink additional 250ml of water
                additionalWaterNeeded = Math.round((totalCaffeine / 100) * 250);
            }

            // Calculate percentage of safe limit
            const percentage = Math.round((totalCaffeine / safeLimit) * 100);

            // Determine status
            let statusClass, statusEmoji, statusText;
            if (percentage < 75) {
                statusClass = 'safe';
                statusEmoji = '‚úÖ';
                statusText = `Safe: Well within daily limits.`;
            } else if (percentage <= 100) {
                statusClass = 'warning';
                statusEmoji = '‚ö†Ô∏è';
                statusText = `Careful: Close to your daily max.`;
            } else {
                statusClass = 'danger';
                statusEmoji = '‚ùå';
                statusText = `Over Limit: Reduce caffeine intake.`;
            }

            // Display results
            document.getElementById('caffeineValue').textContent = `${Math.round(totalCaffeine)} mg`;
            document.getElementById('percentageValue').textContent = `${percentage}%`;
            document.getElementById('percentageValue').className = `result-value status-${statusClass}`;
            
            document.getElementById('hydrationValue').textContent = `${Math.round(adjustedHydration)} ml`;

            // Display safety indicator
            const safetyElement = document.getElementById('safetyValue');
            if (statusClass === 'safe') {
                safetyElement.textContent = '‚úÖ Safe';
                safetyElement.className = 'result-value status-safe';
            } else if (statusClass === 'warning') {
                safetyElement.textContent = '‚ö†Ô∏è Caution';
                safetyElement.className = 'result-value status-warning';
            } else {
                safetyElement.textContent = '‚ùå Unsafe';
                safetyElement.className = 'result-value status-danger';
            }

            const statusMessage = document.getElementById('statusMessage');
            statusMessage.className = `status-message ${statusClass}`;
            statusMessage.innerHTML = `
                ${statusEmoji} <strong>${statusText}</strong><br>
                You consumed ${Math.round(totalCaffeine)} mg caffeine (${percentage}% of safe daily limit for age ${age}).
            `;

            let hydrationMessage = `
                <div class="result-label" style="text-align: center; margin-top: 1rem; color: #64748b;">
                    Net hydration: ${Math.round(adjustedHydration)} ml after adjustment.<br>
                    <em>${hydrationStatus}.</em>
            `;

            if (additionalWaterNeeded > 0) {
                hydrationMessage += `<br><br><strong>üíß Drink ${additionalWaterNeeded}ml additional water</strong> to offset caffeine effects.`;
            }

            hydrationMessage += '</div>';
            document.getElementById('hydrationMessage').innerHTML = hydrationMessage;

            // Generate personalized tips based on user profile
            generatePersonalizedTips(age, totalCaffeine, percentage, isPregnantNursing);

            // Show results with animation
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.remove('hidden');
            setTimeout(() => {
                resultsSection.classList.add('show');
            }, 50);

            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function generatePersonalizedTips(age, totalCaffeine, percentage, isPregnantNursing) {
            const tipsContainer = document.getElementById('personalizedTipsContent');
            let tips = [];

            // Age-specific tips
            if (age < 18) {
                tips.push(`<p><strong>üßí Teen Alert:</strong> At ${age}, your body processes caffeine slower. Keep intake under 100mg daily (about 1 cup of coffee).`);
                tips.push(`<p><strong>üìö Study Smart:</strong> Avoid caffeine after 2 PM to protect your sleep and brain development.`);
                tips.push(`<p><strong>üí™ Natural Energy:</strong> Try exercise, healthy snacks, and proper sleep instead of relying on caffeine.`);
                tips.push(`<p><strong>ü•§ Better Choices:</strong> Choose water, milk, or natural juices over energy drinks and sodas.`);
                if (totalCaffeine > 50) {
                    tips.push(`<p><strong>‚ö†Ô∏è Reduce Now:</strong> You're consuming ${Math.round(totalCaffeine)}mg - consider cutting back gradually to avoid withdrawal.`);
                } else {
                    tips.push(`<p><strong>‚úÖ Good Job:</strong> Your caffeine intake is reasonable for your age. Keep it moderate!`);
                }
            } else if (age >= 18 && age <= 30) {
                tips.push(`<p><strong>üéØ Young Adult:</strong> At ${age}, you can handle up to 400mg daily, but moderation is key for long-term health.`);
                tips.push(`<p><strong>üíº Work Balance:</strong> Space caffeine throughout the day rather than having it all at once.`);
                if (totalCaffeine > 300) {
                    tips.push(`<p><strong>‚ö° High Intake Alert:</strong> ${Math.round(totalCaffeine)}mg is quite high. Consider reducing to avoid tolerance and dependence.`);
                } else {
                    tips.push(`<p><strong>‚òï Timing Tip:</strong> Have your last caffeinated drink 6-8 hours before bedtime.`);
                }
                tips.push(`<p><strong>üèÉ Active Lifestyle:</strong> Combine caffeine with physical activity for better energy management.`);
                tips.push(`<p><strong>üåä Hydration Focus:</strong> Drink an extra glass of water for every caffeinated beverage.`);
            } else if (age > 30 && age <= 50) {
                tips.push(`<p><strong>üßë‚Äçüíº Midlife Balance:</strong> At ${age}, focus on sustainable energy habits rather than caffeine dependence.`);
                if (totalCaffeine > 200) {
                    tips.push(`<p><strong>üìà Metabolism Slowdown:</strong> Your body processes caffeine slower now. Consider reducing your ${Math.round(totalCaffeine)}mg intake.`);
                } else {
                    tips.push(`<p><strong>üëç Smart Consumption:</strong> Your intake level supports good energy without overwhelming your system.`);
                }
                tips.push(`<p><strong>üí§ Sleep Priority:</strong> Limit caffeine after lunch to protect your sleep quality.`);
                tips.push(`<p><strong>üßò Stress Management:</strong> Don't use caffeine to mask stress - address the root causes.`);
                tips.push(`<p><strong>ü•ó Nutrition First:</strong> Maintain steady blood sugar with balanced meals to reduce caffeine cravings.`);
            } else if (age > 50) {
                tips.push(`<p><strong>üåü Mature Wisdom:</strong> At ${age}, your caffeine sensitivity may be higher. The 300mg limit protects your health.`);
                if (totalCaffeine > 150) {
                    tips.push(`<p><strong>üö® Senior Caution:</strong> ${Math.round(totalCaffeine)}mg might affect your sleep and blood pressure. Consider reducing gradually.`);
                } else {
                    tips.push(`<p><strong>‚ú® Perfect Level:</strong> Your moderate intake supports alertness without health risks.`);
                }
                tips.push(`<p><strong>üíä Medication Check:</strong> Some medications interact with caffeine - consult your doctor if needed.`);
                tips.push(`<p><strong>ü¶¥ Bone Health:</strong> Ensure adequate calcium intake as caffeine can affect calcium absorption.`);
                tips.push(`<p><strong>‚ù§Ô∏è Heart Health:</strong> Monitor how caffeine affects your heart rate and blood pressure.`);
            }

            // Pregnancy-specific tips
            if (isPregnantNursing) {
                tips = []; // Clear other tips for pregnancy-specific advice
                tips.push(`<p><strong>ü§∞ Pregnancy Safe:</strong> The 200mg limit protects both you and your baby's development.`);
                tips.push(`<p><strong>üçº Nursing Consideration:</strong> Caffeine passes to breast milk - monitor your baby for restlessness.`);
                tips.push(`<p><strong>‚è∞ Timing Matters:</strong> Have caffeine right after nursing/pumping to minimize baby's exposure.`);
                tips.push(`<p><strong>üíä Supplement Check:</strong> Ensure you're getting enough iron and calcium despite caffeine.`);
                tips.push(`<p><strong>üåä Extra Hydration:</strong> Pregnancy increases fluid needs - drink more water when having caffeine.`);
            }

            // Status-specific tips
            if (percentage > 100) {
                tips.push(`<p><strong>üö® Immediate Action:</strong> You're at ${percentage}% of safe limits. Stop caffeine intake for today and hydrate well.`);
            } else if (percentage > 75) {
                tips.push(`<p><strong>‚ö†Ô∏è Approaching Limit:</strong> At ${percentage}%, consider switching to decaf or herbal alternatives for remaining drinks today.`);
            }

            // Ensure minimum 5 tips
            while (tips.length < 5) {
                const generalTips = [
                    `<p><strong>üîÑ Cycle Break:</strong> Take caffeine-free days weekly to reset your tolerance.`,
                    `<p><strong>ü•õ Slow Absorption:</strong> Add milk or eat protein to slow caffeine absorption and reduce jitters.`,
                    `<p><strong>üåÖ Morning Focus:</strong> Have your strongest drinks in the morning when your body handles caffeine best.`,
                    `<p><strong>üíß Hydration Rule:</strong> Drink 250ml extra water per 100mg caffeine to prevent dehydration.`,
                    `<p><strong>üçΩÔ∏è Never Empty:</strong> Always have food in your stomach before consuming caffeine to avoid stomach irritation.`
                ];
                
                const randomTip = generalTips[Math.floor(Math.random() * generalTips.length)];
                if (!tips.includes(randomTip)) {
                    tips.push(randomTip);
                }
            }

            // Display the personalized tips
            tipsContainer.innerHTML = tips.slice(0, 8).join(''); // Show max 8 tips to keep it readable
        }

        function resetForm() {
            addedDrinks = [];
            updateDrinksList();
            clearForm();
            document.getElementById('pregnantNursing').checked = false;
            document.getElementById('resultsSection').classList.remove('show');
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            updateDrinkInfo();
            initializeNavigation();
            
            // Handle Enter key in form fields
            const formInputs = document.querySelectorAll('#drinkType, #quantity, #drinkName, #caffeineAmount, #servingSize, #age');
            formInputs.forEach(input => {
                input.addEventListener('keypress', function(event) {
                    if (event.key === 'Enter') {
                        addDrink();
                    }
                });
            });

            // Handle window resize for responsive layout
            window.addEventListener('resize', updateFormLayout);
        });
        
        // Navigation toggle functionality (mobile optimized)
        function toggleNavigation() {
            const sideNav = document.getElementById('sideNav');
            const navToggle = document.getElementById('navToggle');
            const body = document.body;
            
            // For mobile
            if (window.innerWidth <= 768) {
                if (sideNav.classList.contains('open')) {
                    sideNav.classList.remove('open');
                    navToggle.classList.remove('active');
                } else {
                    sideNav.classList.add('open');
                    navToggle.classList.add('active');
                }
            } else {
                // For desktop
                if (sideNav.classList.contains('closed')) {
                    sideNav.classList.remove('closed');
                    body.classList.remove('nav-closed');
                    navToggle.classList.remove('active');
                } else {
                    sideNav.classList.add('closed');
                    body.classList.add('nav-closed');
                    navToggle.classList.add('active');
                }
            }
        }
        
        // Close navigation function (for close button)
        function closeNavigation() {
            const sideNav = document.getElementById('sideNav');
            const navToggle = document.getElementById('navToggle');
            const body = document.body;
            
            if (window.innerWidth <= 768) {
                // Mobile: close navigation
                sideNav.classList.remove('open');
                navToggle.classList.remove('active');
            } else {
                // Desktop: close navigation
                sideNav.classList.add('closed');
                body.classList.add('nav-closed');
                navToggle.classList.add('active');
            }
        }
        
        // Initialize navigation state based on screen size
        function initializeNavigation() {
            const sideNav = document.getElementById('sideNav');
            const navToggle = document.getElementById('navToggle');
            const body = document.body;
            
            if (window.innerWidth <= 768) {
                // Mobile: navigation hidden by default
                sideNav.classList.remove('closed', 'open');
                body.classList.remove('nav-closed');
                navToggle.classList.remove('active');
            } else {
                // Desktop: navigation visible by default
                sideNav.classList.remove('closed', 'open');
                body.classList.remove('nav-closed');
                navToggle.classList.remove('active');
            }
        }
        
        // Close navigation when clicking outside on mobile
        document.addEventListener('click', function(e) {
            const sideNav = document.getElementById('sideNav');
            const navToggle = document.getElementById('navToggle');
            
            if (window.innerWidth <= 768 && 
                sideNav.classList.contains('open') && 
                !sideNav.contains(e.target) && 
                !navToggle.contains(e.target)) {
                sideNav.classList.remove('open');
                navToggle.classList.remove('active');
            }
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            initializeNavigation();
        });
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p class="footer-text">
                    üíß Daily Water Calculator - Stay hydrated, stay healthy!
                </p>
                <p class="footer-disclaimer">
                    <a href="/privacy">Privacy Policy</a> | <a href="/about">About Us</a> | <a href="/contact">Contact Us</a>
                </p>
            </div>
        </div>
    </footer>
</body>
</html>